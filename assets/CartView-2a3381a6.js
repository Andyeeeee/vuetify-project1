import{_ as B}from"./icon-05a315e1.js";import{Y as q,_ as N,Z as S,x as z,o as g,aF as h,a2 as u,a3 as d,af as t,c as o,V as b,a5 as r,a7 as f,aN as P,a8 as $,aO as F,ad as c,K as i,ac as k,a6 as I}from"./index-2f815cd8.js";import{b as R,V as T,a as m}from"./VRow-977f2254.js";const j={id:"CartView"},A=t("h1",{class:"text-center"},"點餐清單",-1),D=t("thead",{style:{"background-color":"#d9d9d9",color:"black"}},[t("tr",{class:"tr text-center"},[t("th",null,"圖片"),t("th",null,"名稱"),t("th",null,"單價"),t("th",null,"數量"),t("th",null,"小計"),t("th",null,"操作")])],-1),E={key:0},K=t("td",{colspan:"6",class:"text-center"},"沒有商品",-1),L=[K],O=t("section",{id:"footer",style:{"text-align":"center","background-color":"#003158"}},[t("img",{src:B,alt:"",width:"120",style:{margin:"50px"}}),t("div",null,"114台北市內湖區民權東路六段296巷36號"),t("div",null,"訂位專線：(02) 2631 2626"),t("div",null,"統編： 31864992")],-1),H={__name:"CartView",setup(U){const p=q(),v=N(),y=S(),s=z([]),_=async(a,l)=>{try{const{data:e}=await h.post("/users/cart",{product:a,quantity:l}),n=s.value.findIndex(V=>V.product._id===a);console.log(e),s.value[n].quantity+=l,s.value[n].quantity<=0&&s.value.splice(n,1),v.cart=e.result}catch(e){console.log(e),p({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},C=g(()=>s.value.reduce((a,l)=>a+l.quantity*l.product.price,0)),x=g(()=>s.value.length>0&&!s.value.some(a=>!a.product.sell)),w=async(a,l)=>{try{await h.post("/orders"),v.cart=0,y.push("/orders")}catch(e){p({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(async()=>{try{const{data:a}=await h.get("/users/cart");s.value.push(...a.result)}catch(a){p({text:a.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})(),(a,l)=>(u(),d(f,null,[t("section",null,[o(b,{width:a.auto,"aspect-ratio":"16/9",cover:"",src:"https://d37w6prdd1grkb.cloudfront.net/buzzdaily/2086_news_banner.jpg?ndt=104032"},null,8,["width"])]),t("section",j,[o(R,null,{default:r(()=>[o(T,null,{default:r(()=>[o(m,{cols:"12"},{default:r(()=>[A]),_:1}),o(m,{cols:"12"},{default:r(()=>[o(P,null,{default:r(()=>[D,t("tbody",null,[(u(!0),d(f,null,$(s.value,e=>(u(),d("tr",{key:e._id,class:F({"dg-red-lightrn-4":!e.product.sell})},[t("td",null,[o(b,{src:e.product.image,cover:"",width:"200","aspect-ratio":"1",style:{padding:"20px"},class:"img"},null,8,["src"])]),t("td",null,c(e.product.name),1),t("td",null,c(e.product.price),1),t("td",null,[o(i,{variant:"text",icon:"mdi-plus",onClick:n=>_(e.product._id,1)},null,8,["onClick"]),k(" "+c(e.quantity)+" ",1),o(i,{variant:"text",icon:"mdi-minus",onClick:n=>_(e.product._id,-1)},null,8,["onClick"])]),t("td",null,c(e.quantity*e.product.price),1),t("td",null,[o(i,{variant:"icon",icon:"mdi-delete",onClick:n=>_(e.product._id,e.product._id*-1)},null,8,["onClick"])])],2))),128)),s.value.length===0?(u(),d("tr",E,L)):I("",!0)])]),_:1})]),_:1}),o(m,{cols:"12",class:"text-center"},{default:r(()=>[t("p",null,"總金額:"+c(C.value),1),o(i,{onClick:w,disabled:!x.value,class:"vbtn"},{default:r(()=>[k("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),O],64))}};export{H as default};
