import{p as ue,aR as ie,aw as be,aS as ye,g as ce,D as de,aT as ve,aU as xe,o as G,u as me,aV as fe,aW as J,aX as te,c as t,H as K,aY as we,aZ as he,x as c,s as ke,I as Ce,A as Pe,z as q,B as Fe,a_ as Se,a$ as Be,a7 as Y,U as le,ak as Ie,b0 as Ue,b1 as Me,b2 as Ae,aq as W,b3 as Re,v as De,y as Te,Y as _e,aF as Z,a1 as oe,a2 as ne,a3 as Ne,a5 as i,b4 as He,aP as $e,K as j,ac as L,aK as Q,b5 as ze,V as Ee,a4 as qe,a6 as Ge,aa as s,aJ as Ke,aE as Oe,aB as je,ad as Le,aC as Xe,b6 as se,b7 as Ye,ag as Je,af as We,X as Ze}from"./index-2f815cd8.js";import{c as Qe,a as X,e as ea,f as aa,u as ta,d as H}from"./index.esm-639b4a8a.js";import{b as la,V as oa,a as re}from"./VRow-977f2254.js";import{V as na}from"./VForm-1e5a9673.js";import"./_commonjsHelpers-39b5b250.js";const sa=ue({...ie(),...be(ye(),["inline"])},"VCheckbox"),ra=ce()({name:"VCheckbox",inheritAttrs:!1,props:sa(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,B){let{attrs:x,slots:b}=B;const u=de(e,"modelValue"),{isFocused:d,focus:w,blur:I}=ve(e),D=xe(),k=G(()=>e.id||`checkbox-${D}`);return me(()=>{const[T,y]=fe(x),[_,g]=J.filterProps(e),[p,U]=te.filterProps(e);return t(J,K({class:["v-checkbox",e.class]},T,_,{modelValue:u.value,"onUpdate:modelValue":C=>u.value=C,id:k.value,focused:d.value,style:e.style}),{...b,default:C=>{let{id:P,messagesId:N,isDisabled:$,isReadonly:z}=C;return t(te,K(p,{id:P.value,"aria-describedby":N.value,disabled:$.value,readonly:z.value},y,{modelValue:u.value,"onUpdate:modelValue":M=>u.value=M,onFocus:w,onBlur:I}),b)}})}),{}}});const ua=ue({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...ie(),...we()},"VTextarea"),ia=ce()({name:"VTextarea",directives:{Intersect:he},inheritAttrs:!1,props:ua(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,B){let{attrs:x,emit:b,slots:u}=B;const d=de(e,"modelValue"),{isFocused:w,focus:I,blur:D}=ve(e),k=G(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),T=G(()=>{if(x.maxlength)return x.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function y(n,v){var r,f;!e.autofocus||!n||(f=(r=v[0].target)==null?void 0:r.focus)==null||f.call(r)}const _=c(),g=c(),p=ke(""),U=c(),C=G(()=>e.persistentPlaceholder||w.value||e.active);function P(){var n;U.value!==document.activeElement&&((n=U.value)==null||n.focus()),w.value||I()}function N(n){P(),b("click:control",n)}function $(n){b("mousedown:control",n)}function z(n){n.stopPropagation(),P(),W(()=>{d.value="",Re(e["onClick:clear"],n)})}function M(n){var r;const v=n.target;if(d.value=v.value,(r=e.modelModifiers)!=null&&r.trim){const f=[v.selectionStart,v.selectionEnd];W(()=>{v.selectionStart=f[0],v.selectionEnd=f[1]})}}const F=c(),h=c(+e.rows),S=G(()=>["plain","underlined"].includes(e.variant));Ce(()=>{e.autoGrow||(h.value=+e.rows)});function V(){e.autoGrow&&W(()=>{if(!F.value||!g.value)return;const n=getComputedStyle(F.value),v=getComputedStyle(g.value.$el),r=parseFloat(n.getPropertyValue("--v-field-padding-top"))+parseFloat(n.getPropertyValue("--v-input-padding-top"))+parseFloat(n.getPropertyValue("--v-field-padding-bottom")),f=F.value.scrollHeight,A=parseFloat(n.lineHeight),E=Math.max(parseFloat(e.rows)*A+r,parseFloat(v.getPropertyValue("--v-input-control-height"))),o=parseFloat(e.maxRows)*A+r||1/0,a=Te(f??0,E,o);h.value=Math.floor((a-r)/A),p.value=De(a)})}Pe(V),q(d,V),q(()=>e.rows,V),q(()=>e.maxRows,V),q(()=>e.density,V);let m;return q(F,n=>{n?(m=new ResizeObserver(V),m.observe(F.value)):m==null||m.disconnect()}),Fe(()=>{m==null||m.disconnect()}),me(()=>{const n=!!(u.counter||e.counter||e.counterValue),v=!!(n||u.details),[r,f]=fe(x),[{modelValue:A,...E}]=J.filterProps(e),[o]=Se(e);return t(J,K({ref:_,modelValue:d.value,"onUpdate:modelValue":a=>d.value=a,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-text-field--plain-underlined":S.value},e.class],style:e.style},r,E,{centerAffix:h.value===1&&!S.value,focused:w.value}),{...u,default:a=>{let{isDisabled:R,isDirty:O,isReadonly:l,isValid:ee}=a;return t(Be,K({ref:g,style:{"--v-textarea-control-height":p.value},onClick:N,onMousedown:$,"onClick:clear":z,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:"textbox"},o,{active:C.value||O.value,centerAffix:h.value===1&&!S.value,dirty:O.value||e.dirty,disabled:R.value,focused:w.value,error:ee.value===!1}),{...u,default:ge=>{let{props:{class:ae,...pe}}=ge;return t(Y,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),le(t("textarea",K({ref:U,class:ae,value:d.value,onInput:M,autofocus:e.autofocus,readonly:l.value,disabled:R.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:P,onBlur:D},pe,f),null),[[Ie("intersect"),{handler:y},null,{once:!0}]]),e.autoGrow&&le(t("textarea",{class:[ae,"v-textarea__sizer"],"onUpdate:modelValue":Ve=>d.value=Ve,ref:F,readonly:!0,"aria-hidden":"true"},null),[[Ue,d.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:v?a=>{var R;return t(Y,null,[(R=u.details)==null?void 0:R.call(u,a),n&&t(Y,null,[t("span",null,null),t(Me,{active:e.persistentCounter||w.value,value:k.value,max:T.value},u.counter)])])}:void 0})}),Ae({},_,g,U)}}),ca=We("h1",{class:"text-center"},"商品管理",-1),pa={__name:"ProductsView",setup(e){const B=_e(),x=c(5),b=c([{key:"name",order:"asc"}]),u=c(1),d=c([]),w=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"說明",align:"center",sortable:!1,key:"description"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"分類2",align:"center",sortable:!0,key:"category2"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],I=c(!1),D=c(0),k=c(""),T=()=>{u.value=1,y()},y=async()=>{I.value=!0;try{const{data:o}=await Z.get("/products/all",{params:{page:u.value,itemsPerPage:x.value,sortBy:b.value[0].key,sortOrder:b.value[0].order,search:k.value}});d.value.splice(0,d.value.length,...o.result.data),D.value=o.result.count}catch(o){B({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}I.value=!1};y();const _=o=>{p.value=o._id,h.value.value=o.name,S.value.value=o.price,V.value.value=o.description,m.value.value=o.category,m.value.categorytwo=o.categorytwo,v.value.value=o.sell,g.value=!0},g=c(!1),p=c(""),U=()=>{p.value="",g.value=!0},C=()=>{g.value=!1,F(),A.value.deleteFileRecord()},P=["主食","開胃菜","飲品","下午茶"],N=["青醬","紅醬","白醬","粉紅醬","清炒","義式燉飯","輕鬆點","炸物拼盤","特色沙拉","薄餅披薩","現磨咖啡","茶","鮮榨果汁","其他","甜點","現烤鬆餅","沐沐三明治","磚壓吐司"],$=Qe({name:X().required("缺少名稱"),price:ea().typeError("缺少價格").required("缺少價格").min(0,"價格錯誤"),description:X().required("缺少說明"),category:X().required("缺少分類").test("isCategory",o=>P.includes(o)),categorytwo:X().required("缺少分類2").test("categorytwo",o=>N.includes(o)),sell:aa()}),{handleSubmit:z,isSubmitting:M,resetForm:F}=ta({validationSchema:$,initialValues:{name:"",price:0,description:"",category:"",categorytwo:"",sell:!1}}),h=H("name"),S=H("price"),V=H("description"),m=H("category"),n=H("categorytwo"),v=H("sell"),r=c([]),f=c([]),A=c(null),E=z(async o=>{if(!(p.value.length===0&&r.value.length===0))try{const a=new FormData;a.append("name",o.name),a.append("price",o.price),a.append("description",o.description),a.append("category",o.category),a.append("categorytwo",o.categorytwo),a.append("sell",o.sell),r.value.length>0&&a.append("image",r.value[0].file),p.value.length>0?await Z.patch("/products/"+p.value,a):await Z.post("/products",a),B({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),C(),y()}catch(a){console.log(a),B({text:a.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(o,a)=>{const R=oe("VDataTableServer"),O=oe("VueFileAgent");return ne(),Ne(Y,null,[t(la,{id:"ProductsView"},{default:i(()=>[t(oa,null,{default:i(()=>[t(re,{cols:"12"},{default:i(()=>[ca]),_:1}),t($e),t(re,{cols:"12"},{default:i(()=>[t(j,{color:"green",onClick:U},{default:i(()=>[L("新增商品")]),_:1}),t(R,{"items-per-page":x.value,"onUpdate:itemsPerPage":[a[1]||(a[1]=l=>x.value=l),y],"sort-by":b.value,"onUpdate:sortBy":[a[2]||(a[2]=l=>b.value=l),y],page:u.value,"onUpdate:page":[a[3]||(a[3]=l=>u.value=l),y],items:d.value,headers:w,loading:I.value,"items-length":D.value,search:k.value,hover:""},{top:i(()=>[t(Q,{label:"搜尋","append-icon":"mdi-magnify","onClick:append":T,onKeydown:ze(T,["enter"]),modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=l=>k.value=l),class:"color"},null,8,["onKeydown","modelValue"])]),["item.image"]:i(({item:l})=>[t(Ee,{src:l.raw.image,height:"50px"},null,8,["src"])]),["item.sell"]:i(({item:l})=>[l.raw.sell?(ne(),qe(Ze,{key:0,icon:"mdi-check"})):Ge("",!0)]),["item.edit"]:i(({item:l})=>[t(j,{icon:"mdi-pencil",onClick:ee=>_(l.raw),variant:"text"},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(He,{persistent:"",width:"500px",modelValue:g.value,"onUpdate:modelValue":a[12]||(a[12]=l=>g.value=l)},{default:i(()=>[t(na,{disabled:s(M),onSubmit:Ke(s(E),["prevent"])},{default:i(()=>[t(Oe,null,{default:i(()=>[t(je,null,{default:i(()=>[L(Le(p.value.length>0?"編輯商品":"新增商品"),1)]),_:1}),t(Xe,null,{default:i(()=>[t(Q,{label:"名稱",modelValue:s(h).value.value,"onUpdate:modelValue":a[4]||(a[4]=l=>s(h).value.value=l),"error-messages":s(h).errorMessage.value},null,8,["modelValue","error-messages"]),t(Q,{label:"價格",modelValue:s(S).value.value,"onUpdate:modelValue":a[5]||(a[5]=l=>s(S).value.value=l),modelModifiers:{number:!0},"error-messages":s(S).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(ia,{label:"說明",modelValue:s(V).value.value,"onUpdate:modelValue":a[6]||(a[6]=l=>s(V).value.value=l),"error-messages":s(V).errorMessage.value},null,8,["modelValue","error-messages"]),t(se,{label:"分類",modelValue:s(m).value.value,"onUpdate:modelValue":a[7]||(a[7]=l=>s(m).value.value=l),"error-messages":s(m).errorMessage.value,items:P},null,8,["modelValue","error-messages"]),t(se,{label:"分類2",modelValue:s(n).value.value,"onUpdate:modelValue":a[8]||(a[8]=l=>s(n).value.value=l),"error-messages":s(n).errorMessage.value,items:N},null,8,["modelValue","error-messages"]),t(ra,{label:"上架",modelValue:s(v).value.value,"onUpdate:modelValue":a[9]||(a[9]=l=>s(v).value.value=l),"error-messages":s(v).errorMessage.value},null,8,["modelValue","error-messages"]),t(O,{modelValue:r.value,"onUpdate:modelValue":a[10]||(a[10]=l=>r.value=l),"raw-model-value":f.value,"onUpdate:rawModelValue":a[11]||(a[11]=l=>f.value=l),"max-files":1,"max-size":"2MB",accept:"image/jpg,image/jpeg,image/png",multiple:!1,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖放到這裡",deletable:"",ref_key:"fileAgent",ref:A},null,8,["modelValue","raw-model-value"])]),_:1}),t(Ye,null,{default:i(()=>[t(Je),t(j,{color:"red",onClick:C,loading:s(M)},{default:i(()=>[L("取消")]),_:1},8,["loading"]),t(j,{color:"green",type:"submit",loading:s(M)},{default:i(()=>[L("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{pa as default};
