import{Y as V,_ as w,Z as B,x as q,o as y,aF as h,a2 as u,a3 as d,c as s,a5 as r,aN as N,aa as e,a7 as S,a8 as P,a6 as $,ag as n,K as i,af as m,aS as F,V as I}from"./index-685aac8c.js";import{b as R,V as T,a as k}from"./VRow-c2ace5e2.js";const z={id:"CartView"},A=e("h3",{class:"text-center"},"點餐清單",-1),D=e("thead",null,[e("tr",{class:"text-center tr"},[e("th",{style:{color:"black"}},"圖片"),e("th",{style:{color:"black"}},"名稱"),e("th",{style:{color:"black"}},"單價"),e("th",{style:{color:"black"}},"數量"),e("th",{style:{color:"black"}},"小計"),e("th",{style:{color:"black"}},"操作")])],-1),E={key:0},K=e("td",{colspan:"6",class:"text-center"},"沒有商品",-1),L=[K],j={__name:"CartView",setup(U){const p=V(),b=w(),v=B(),o=q([]),_=async(a,l)=>{try{const{data:t}=await h.post("/users/cart",{product:a,quantity:l}),c=o.value.findIndex(x=>x.product._id===a);console.log(t),o.value[c].quantity+=l,o.value[c].quantity<=0&&o.value.splice(c,1),b.cart=t.result}catch(t){console.log(t),p({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},C=y(()=>o.value.reduce((a,l)=>a+l.quantity*l.product.price,0)),f=y(()=>o.value.length>0&&!o.value.some(a=>!a.product.sell)),g=async(a,l)=>{try{await h.post("/orders"),b.cart=0,v.push("/orders")}catch(t){p({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(async()=>{try{const{data:a}=await h.get("/users/cart");o.value.push(...a.result)}catch(a){p({text:a.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})(),(a,l)=>(u(),d("section",z,[s(R,null,{default:r(()=>[s(T,null,{default:r(()=>[s(k,{cols:"12"},{default:r(()=>[A]),_:1}),s(k,{cols:"12"},{default:r(()=>[s(N,null,{default:r(()=>[D,e("tbody",null,[(u(!0),d(S,null,P(o.value,t=>(u(),d("tr",{key:t._id,class:F({"dg-red-lightrn-4":!t.product.sell})},[e("td",null,[s(I,{src:t.product.image,cover:"",width:"200","aspect-ratio":"1",style:{padding:"20px"},class:"img"},null,8,["src"])]),e("td",null,n(t.product.name),1),e("td",null,n(t.product.price),1),e("td",null,[s(i,{variant:"text",icon:"mdi-plus",onClick:c=>_(t.product._id,1)},null,8,["onClick"]),m(" "+n(t.quantity)+" ",1),s(i,{variant:"text",icon:"mdi-minus",onClick:c=>_(t.product._id,-1)},null,8,["onClick"])]),e("td",null,n(t.quantity*t.product.price),1),e("td",null,[s(i,{variant:"icon",icon:"mdi-delete",onClick:c=>_(t.product._id,t.product._id*-1)},null,8,["onClick"])])],2))),128)),o.value.length===0?(u(),d("tr",E,L)):$("",!0)])]),_:1})]),_:1}),s(k,{cols:"12",class:"text-center"},{default:r(()=>[e("p",null,"總金額:"+n(C.value),1),s(i,{onClick:g,disabled:!f.value,class:"vbtn"},{default:r(()=>[m("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]))}};export{j as default};
